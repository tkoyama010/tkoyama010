それでははいよろしくお願いいたします。
本日はトークの機会をいただきありがとうございます。
本日はですねPythonで3次元CGを作りたい人のためのPyVista入門と題してPythonで3次元CGを作成する方法について小山がお話しさせていただきます。
よろしくお願いします。
まず自己紹介をさせていただきます私は小山哲央と申します。
GitHub上で活動していることが多いです。
Pythonの3DCG可視化ライブラリであるPyVistaのライブラリのメンテナンスとドキュメント翻訳をさせていただいています。
アカウント名はtkoyama010というアカウント名を使うことが多いです。
もしもよろしければフォローいただけるとありがたいです。
本日の内容をで目次にしてみました。
まずはPythonでCGを作る際に必要なことの概要をお話しして、その後実際に3次元CGを作成する方法を順番にご紹介していきたいと思います。
モデリング・テクスチャー・マテマテリアル・ライティングという専門用語があるんですけどもそちらについて基本的なことを説明してさせていただきます。
次にですねPythonでCGを作った後にせっかくかなので空間のデータ分析をしてみようということでデータ分析の方法についてえご説明させていただきます。
最後にですね応用例としてインタラクティブな可視化の方法についていくつかご紹介させていただきたいと思います。
おそらくですねここにいらっしゃる方は結構Pythonには慣れていらっしゃるかと思います。
一方、CGを作るというのは結構初めての方がいらっしゃるかと思います。
そこでですねあまり時間は取れないんですけども簡単にCGの基本的なな操作方法についてご説明申し上げたいと思います
まずはモデリングについててご説明します。
今ここに仮想3次元空間という仮想の空間があります。
個々のポリゴンを作る作業になっています。
CGを作る際にはこの作業が最も基本的なものとなっていましてこれによって仮想空間上に自分の作成したい物体を配置することは可能となっています。
でこのようにえ円柱のポリゴンが作成されていまして。
こちらですね、今回のえ結構目玉機能なんですけども、このインタラクティブシンというタブをクリックしていただくとこのようにCGがインタラクティブに表示されます。
はいでこれにの原理とかについては後ほどご説明させていただきます。
次にですねテクスチャーマッピングについてご説明します。
テクスチャーマッピングはオブジェクトの質感を表現するための画像となっております。
先ほどのモデリングで作成したオブジェクトにですねテクスチャーを貼り付けることで右の図のようにCGをよりリアルに表現することができます。
このように円柱に地球の画像を貼り付けたちょっと謎のオブジェクトがあるんですけども、実際にそこに物があるようにもオブジェクトを見せるためにこのようにテクスチャーを貼り付けるという操作がコンピューターグラフィックではございます。
次の操作がですねライティングと言いまして3D空間上に光を配置してオブジェクトを照らすことでえコンピューターグラフィックのクオリティを上げるあ操作となっています。
はいでこちらですね円柱を表示している画面になっているんですけども、ポインターがある方向から光が照らされていてこのように円柱に影ができているという形となっています。
以上のコンピューターグラフィックの要素を組み合わせて3次元CGを作成していくことになります。
これらの3次元CG作業をそれぞれPythonで実現する方法を考えた際に今現状で1番使いやすいと思われるのがこちらのPyVistaというライブラリです。
このPyVistaはですねMatplotlibとかPandasなどののAPIを意識して作成されていますので、これらに習熟されている皆さんであれば簡単に使用を始めることができるものになっています。
皆さん2次元のグラフなどを表示をする際にはですねMatplotlibを一般的に使われるという思います。
Matplotlibというのは2次元のグラフを描画するにはとても強力なライブラリなんですけども3次元プロットの機能はそれほど強力ではないとなものとなっていますなので3次元の空間情報や物体がどのように変形するかなどを表現するには機能が不足しています。
そこで、Matplotlibで実現的内CCについてはPyVistaで実現しようというユーザーのニーズがございます。
はいでこちらのライブラリはですねpipインストールというコマンドでインストールすることは可能となっています。
もちろんcondaのインストールパッケージも用意はされているんですけどもpipでインストールすることが一般的となっています。
でpipインストールパスタとすると最低限の
パスターのライブラリがインストールさ
れるんですけどもこの後ご説明するジパー
の拡張機能をインストール
するためにはPPインストールパスタ
オールという風
にコマンドを打っていただく必要があり
ますこのオールという鍵括弧で囲まれ
た部分がオプションとなっていましてこれ
で全てのオプションをインストール
してくださいというコマンドとなって
い
ますはいではこれでスールが完了し
ましたので実際にコンピューター
グラフィックを作ってみてあ作ってみ
ましょうまずはモデリングをして
みようということでえ先ほどごご説明した
モデリングのパートをご説明し
ますPビスタをえあ失礼
Pythonを起動していただいて
ビスタをインポートしますでpyの
ライブラリにはですねエリアスという
ものをけることができます例えばですね
NumであればイーNumPiasNPと
いうエリアスをつつけることができる
ようにPビスタではPVというエリアスで
インポートをし
ますでこちこのPVというのはですねP
ビスタで監修的に使われてる
エイリアスでして皆さんもこれを使って
いただければと思いますで次にですね
シリンダーという関数を使って延長の
モデルを作成いたしますで5では様々な
モデルを作成する関数が用意されており
まして
このシリンダーという延長を作成する関数
もその中の1つですこのような関数を使う
ことによって簡単にモデルを作成を
することができますで作成したモデルま
ポリゴンというもて言っていいかと
思いますけどもそのポリゴンのメソッドに
プロットというメソッドがございますので
そのプロットというメソッドを呼び出して
あげるとこの右側のようにモデルの
プロットが行われるという形となってい
ます
これはですねかなりマットプロット
リブを意識した仕様となっていまして
Matplotlibに慣れた方であれば
比較的簡単に使用できるかという風
に思いますはいこのような
インタラクティブな3次元のポリゴンが
作成されるという形となってい
ますでまたですね複数のモデルを
作成することも可能ですマットプロット
リブにおいては複数のグラフを作成する際
にフィギュアオブジェクトを使って
複数のグラフを描画することができると
いうのはマットプロブをよくご存知の方は
ご存知だという思うんですけどもパイ
ビスタでも同様にプロッターオブジェクト
というオブジェクトを作成してそれで複数
のモデルを化することは可能ですこちらの
コードではプロッターオブジェクトを使っ
て中を2つ描画していますまず
プロッターオブジェクトを作成して
いただいてそして先ほどと同じように
ポリゴンですねメッシュを作成して
いただきますでそのメッシュをアメッシュ
メソッドを使っ
てこのプロッターの画面の中に追加をして
あげますで今回ですね2つオブジェクトを
追加をしたいということで1つ目を少し
ずらしてあげ
ますこちらです
ねメッシュのメソッドに
を移動するというメソッドになってい
ますでこのメッシュ自体を移動させたいと
いうことですので引数でinplace=
TRUEという設定をして移動方向の
ベクトルをXYZという引数で指定して
あげますこれはですねパンスのAPIを
意識した形となっていましてまパン
ダスをえに慣れた方であれば簡単に
使いこなせるかという思いますでこれ
でメッシュ自体が更新をされましてそれで
こちら右のようにプロットをすると
いう形になりますでプロットをする
際にですねその前にもう1つ液中を追加を
するとでこれも2回目のアメッシュ
メソッドを呼び出すことによってこのよう
に2つのメッシュをプロットすることは
可能となっていますでめでたくこの
ようにメッシがプロットするとまたまたま
この円球が
繋がる位置にえメを持っていっ
たんですけどもまこのように複数のモデル
を自在に追加をすることができると
いう形となっておりますで次に
テクスチャーについてご説明させて
いただき
ますこのテクスチャーというのが
ですね先ほどご説明したように
モデルに画像をの表面に追加を
するという機能になっていましてこれを
実現するためにはまえパスタからの
エグザンプルのデータからですね画像の
サンプルをダウンロードします
そしてそれをリードテクスチャーという風
な関数でテクスチャーとして読み込みます
こちらですねテクスチャーには座標
情報どの位置にプロットをその
画像をプロットするかという座標
座標情報が含まれていますので画像
ファイルそのものとはまた異なりますので
ご注意くださいでこちらで読み込んだ
テクスチャーファイルですねそれを
引数に指定してあげてプロットをしてあげ
ますするとこのように先ほどご提示
したように円柱の表面に画像がプロットさ
れているというそのような
オブジェクトが作成され
ますはいでこのようにですねテクスチャを
使って画像を貼り付けることで質感を表現
することははできるんですけどもあまり
リアリティがありませんそこでですね背景
を設定して背景の映り込みをテクスチャー
とせして設定することでよりリアリティの
あるCGを作成していこうと思い
ますまずはですねオブジェクトAの
映り込みに使用する背景を表示してみます
ゲームだなどCGを作成する際には背景に
スイボックスを設定することが一般的です
こちらの左下の画像がskyboxの例
です左右前後の6つの面の画像を背景に
設定することで全方向に背景を表示する
ことができ
ますパスタではダウンロードskybox
キュブマップという関数ちょっと名前
が長いんですけどもそれを使って標準の
スカイボックスをダウンロードすることが
でき
ますこちらの右がですねスカイボックスを
表示した例ですで中央にこれサンプルなん
ですけどもQが表示されていますこれを
使って背景の映り込みをテクスチャーとし
て設定することでよりリアリティのある
CGを作成してみ
ますそれでは質感と背景の映り込みを追加
をしてみましょうまずはskybox
を背景に設定し
ますその次にえ背景の映り込みを
テクスチャーとして設定しますその際には
ですねそれぞれアアクターとセット
エンバイロメントテクスチャーという
メソッドをそれぞれ設定をして背景と
テクスチャーの映り込みを決定することが
できますさらにオブジェクト自体にですね
物理ベースレンダリングPBRという
手法があるんですけどもこれも
ゲームでよく使用される
テクスチャーの設定ですねそれをトルと
いうフラグで設定をしてあげてそして
映り込みのこの表面具合を設定をしてあげ
ますそうすることでこの右に示している
ようによりリアリティのある延長を表示
することは可能となり
ます次にライティングについてご
説明し
ます先ほどご説明した通りライティングは
今まで作成をしたオブジェクトに光を
当てることで光と鍵を表現する操作です
PyVistaにはライトオブジェクトという
オブジェクトまクラスですねが定義されて
い
ますでこれを設定することで2をえ定義を
するんですけどもファスタのプロッター
オブジェクトには実はデフォルトでライト
オブジェクトがすでに設定してありまして
ライトオブジェクトを独立に定義するに際
にはこのプロッタークラスでライトニング
を無効にしておく必要があり
ます無効にした上で仮想空間上に光
を配置する設定をライトクラスで定義をし
てあげ
ますその際にはですね光の種類今回はシ
ライトという光の種類を使いますけども
それを設定してあげて光源をどの位置に
設定するかを設定してあげ
ますそしてそれをプロッタークラスの
アライトメソッドを使用することによって
光を追加をしてあげますそうすることで
こちらの右に示すように円柱の片側から光
が
え光がえ照らされているという状態を
再現することができますで最初です
ねライトニングを無効にしていたんです
けどもこれを有効にしていてデフォルトの
光にしてあげてるとどういうことに
なるかと言いますとこのライト
タイプという光のタイプがカメラタイプに
なっていましカメラタイプにな視点タイプ
になりましてユーザーが見る方向
から光が当たるようになりますそうすると
影が一切見えずにオブジェクト全体
の様子が分かるというそのような形と
なっており
ますはいで以上でですねコンピューター
グラフィックの一通りの操作が
Pythonで実現できるということがお
分かりいただけたという思いますが
せっかくPythonを使っているので
単にコンピューターグラフィックをする
だけではなくて空間のデータ分析もして
それの結果を表示してみましょうと
いうことが次のセクションの
紹介となります
はいでPyVistaではですね
ポリゴンの1つ1つのセルですねに
データを持たせてPandasのように処理
するメソッドが整備をされてい
ますで今回はその基本的な使い方について
ご説明をしたいと思い
ます今回minecのような洞窟を
作ってみようということでこのような右の
方にですね示すようなデータを準備
いたしましたでこのこれがどのよう
なデータかというのはえ左の方のコードで
説明をしているんですけど
も上下えと左右ですね3方向に作成
されたグリッドになっていますでグリッド
1つ1つにデータが配置されていまして
そのグリッドのデータがこのように
右に示すようにですねコンターで表示をさ
れてい
ますでこのデータをどのように配置
した作成したかと言いますと先ほどご
説明したようにですね1個1個ポリゴンを
あ立方体のポリゴンを設定をしてあげて
さらにですねデータをNumパイの配列で
準備をしてあげ
ますで念のためですねこのポリゴン
の数とNumパイのデータの数がが
一緒であるというのを確認をしておいて
くださいでこれを準備したすあすることで
このデータ
をポリゴンに辞書のように定義を
することができ
ます今回はデータという名前でこの
データを定義をしてあげてそして後でです
ね辞書のように呼び出すとこのように各
ポリゴンに対してどのような値が設定され
ているかというのを確認することができ
ますはいでかなり説明をはっ
ていますけどもこれでデータの
準備ができましたでこのデータを
処理をして結果を表示しようという形
となっておりますでその際にはです
ねまずデータの最大値と最小値を取得
して確認を行いますその結果この
保持しているデータは最小が0.85最大
が0.93ということが分かり
ますここイはですねの普通のNum
パイの配列と処理は同じですので
皆さんが使い慣れたメソッドを使用
することが可能ですでこのポリゴン
をですねデータが0.565より大きい
グリッドだけ抽出をしてくださいという風
に設定をしますでこちらですね右のこの
コンターを見ていただくと
0.65すいません失礼します
1つ戻りますねこちらの0.5665
この白い部分ですねこの白い部分の
データよりも大きい部分だけ取り出そうと
いう処理を行い
ますはいでここいらはですね
Pandasのメソドと同じようなえ似たよう
なAPIで処理を行うことができ
ましてポリゴンを抜き出すことが
できるとでえ抽出した後にもちろんさ
後のポリゴンにもデータが保持されている
わけですけどもその最大と最小を見てみる
とこのように確かに0.565以上の値が
出力されているということが分かり
ますでえ右がその結果になりますで
白い部分がですね全て削除をされ
まし
て土色の部分と青色の部分のみが残された
状態となりますでこちらですね
様よくやるmcraのような洞窟が作成さ
れるという形となっていましてこの
ようにグリグリ動かして洞窟の中を
回ってみると結構楽しめるかという
思いますはいで今回ですねこの
ポリゴンに使用したデータの作成の仕方
などについてはえま時間の都合上を省かせ
ていただきましたのでもしもご興味があれ
ば後でご質問していただければと思い
ますはいで以上で
コンピューターグラフィックを作りさらに
3DCGの空間の中で3事件の
空間のデータ分析をするということを行い
まし
たで最後にですねこのような
PyVistaというライブラリが
Pythonのエコシステムの中でどの
ように活用しているか活用されているかと
いうことを応用あ応用事例ですね
それを紹介させていただいて終わり
としたいという
ます皆様
えPythonの結果を表示される
と際に様々なものツールをえ使わ
れるかと思いますまもちろんpyon
のエコシステムの中には様々なツールが
ございますのでえと使結果の表示に使わ
れるという思うんですけどもその中で
3点ほどご紹介したいと思いますまず
1つ目がスフィンクスですね
こちらえとスタートPythonクラブの
方にも確かスフィンクス界という
ものがあったという思いますけどもえ
ドキュメントのソフトのデファクト
スタンダードほぼデファクトスタンダード
ですねとなっているものですで
こちらですねスフィンクスで
エクステンションを使う際にプロ
ディレクティブというものが使用さ
れるんですけどもビスタをインストール
することによって標準で5ビスタ
プロットというディレクティブが定義
されますでこのディレクティブでですね
PyVistaをを使ったPython
コードを設定することによって右のような
今日えスライドでお見せしたような
インタラクティブな3次元の3DCGが
描画されるという機能がございますで
実はですねこのスライド自身も
スフィンクスで作成をしていまして
スフィンクスリビールJSという
今日の主催の日記さんと
かが有名なユーザーでいらっしゃいます
けどもえで作成されています
でこちらですねスフィンクス
リビールJSのスライドの作り方について
えはい曜日のある方は是非
スフィンクスリビールJSで検索をしてみ
てくださいはい日本人の竹さんという
方がえ作成をされてい
ますで次にジュパターによる
貸家についてご紹介しますこちらは
ジュパイタを使用した貸化なんです
けども
先ほどのPyVistaのオールの
オプションを設定することによって今動画
でお見せしているようにパターによる貸化
が可能となっていますでジパイタ上
でもですねスタティックな画像では
なくこのようにインタラクティブな画像で
結果を表示することはできますので先ほど
の3次元でのデータ分析を含めジパイタで
の分析
にコンピューターグラフィックを活用
いただければと思い
ますはいで最後にごごご説明
するのがストリームリットですね現在
ジュパイタと並んでとても人気
のあるデータの可視化のえライブラリの
1つとなっていますでこちら簡単に
Webアプリが作れるという
コンセプトで開発が進められている
プロジェクトなんですけどもこちらにも
PyVistaは対応しておりまして
これは本家にえ内されたものではなく
サードパーティーとして開発されたものな
んですけどもSTパスタという
プロジェクトがございますでそれを
インストールすることでですねストリー
ブリッドでもこのようにインタラクティブ
なコンピューターグラフィックを描画する
ことが可能となっておりますはいという
ことでご清聴どうもありがとう
ございましたこのプロジェクトは
ですね完全ボランティアで進めておりまし
てえコントリビューターの皆様にはえ
とても感謝をしておりますまたですね
私たち完全ボランティアですの
でこのプロジェクトにスターを
いただけるともしもこのプロジェクト
が気に入ったらスターをいただける
ととても励みになりますので是非よろしく
お願いいたしますはい私からの発表は以上
になりますありがとうございました。
